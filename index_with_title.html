<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing Paper Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .controls>div {
            flex: 1;
            min-width: 200px;
        }

        canvas {
            border: 1px solid #ccc;
            max-width: 100%;
            height: auto;
        }

        button {
            margin-top: 10px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #redLinePadding,
        #headerHeight {
            width: 50px;
        }

        .color-picker {
            display: flex;
            align-items: center;
        }

        .color-picker input[type="color"] {
            margin-left: 10px;
        }

        /* Previous styles remain the same */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
        }
    </style>
</head>

<body>
    <h1>Writing Paper Generator</h1>
    <div class="controls">
        <div>
            <label for="paperType">Paper Type:</label>
            <select id="paperType">
                <option value="empty">Empty</option>
                <option value="grid">Grid</option>
                <option value="dot">Dot</option>
                <option value="line">Line</option>
            </select>
        </div>
        <div>
            <label for="spacing">Spacing (mm):</label>
            <select id="spacing">
                <option value="3">3mm</option>
                <option value="4">4mm</option>
                <option value="5">5mm</option>
                <option value="6">6mm</option>
                <option value="7">7mm</option>
                <option value="8">8mm</option>
                <option value="9">9mm</option>
                <option value="10">10mm</option>
            </select>
        </div>
        <div class="color-picker">
            <label for="bgColor">Background Color:</label>
            <select id="bgColor">
                <option value="white">White</option>
                <option value="#FFFFD4">Pale Yellow</option>
                <option value="#F0F8FF">Light Blue</option>
                <option value="custom">Custom</option>
            </select>
            <input type="color" id="customBgColor" value="#FFFFFF">
        </div>
        <div class="color-picker">
            <label for="lineColor">Line Color:</label>
            <select id="lineColor">
                <option value="#CCCCCC">Light Gray</option>
                <option value="#0000FF">Blue</option>
                <option value="#800080">Purple</option>
                <option value="custom">Custom</option>
            </select>
            <input type="color" id="customLineColor" value="#CCCCCC">
        </div>
        <div>
            <label for="pageSize">Page Size:</label>
            <select id="pageSize">
                <option value="A4">A4</option>
                <option value="A5">A5</option>
                <option value="B5">B5</option>
                <option value="B6">B6</option>
                <option value="A6">A6</option>
            </select>
        </div>
        <div>
            <label for="redLine">Red Line (for line type):</label>
            <input type="checkbox" id="redLine">
        </div>
        <div>
            <label for="redLinePadding">Red Line Padding (mm):</label>
            <input type="number" id="redLinePadding" min="0" max="50" value="20">
        </div>
        <div>
            <label for="headerHeight">Header Height (mm):</label>
            <input type="number" id="headerHeight" min="0" max="50" value="20">
        </div>
        <div class="checkbox-group">
            <label><input type="checkbox" id="titleSection"> Title Section</label>
            <label><input type="checkbox" id="noField"> No. Field</label>
            <label><input type="checkbox" id="dateField"> Date Field</label>
        </div>
    </div>
    <canvas id="paperCanvas"></canvas>
    <br>
    <button onclick="generatePDF()">Generate PDF</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const canvas = document.getElementById('paperCanvas');
        const ctx = canvas.getContext('2d');

        const pageSizes = {
            'A4': [210, 297],
            'A5': [148, 210],
            'B5': [176, 250],
            'B6': [125, 176],
            'A6': [105, 148]
        };

        const defaultRedLinePadding = {
            'A4': 20,
            'A5': 15,
            'B5': 18,
            'B6': 12,
            'A6': 10
        };
        function drawPaper() {
            const paperType = document.getElementById('paperType').value;
            const spacing = parseInt(document.getElementById('spacing').value);
            const bgColorSelect = document.getElementById('bgColor');
            const lineColorSelect = document.getElementById('lineColor');
            const pageSize = document.getElementById('pageSize').value;
            const redLine = document.getElementById('redLine').checked;
            const redLinePadding = parseInt(document.getElementById('redLinePadding').value);
            const headerHeight = parseInt(document.getElementById('headerHeight').value);
            const titleSection = document.getElementById('titleSection').checked;
            const noField = document.getElementById('noField').checked;
            const dateField = document.getElementById('dateField').checked;

            const [width, height] = pageSizes[pageSize];
            canvas.width = width * 3.78;
            canvas.height = height * 3.78;

            // Set background color
            let bgColor = bgColorSelect.value;
            if (bgColor === 'custom') {
                bgColor = document.getElementById('customBgColor').value;
            }
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Set line color
            let lineColor = lineColorSelect.value;
            if (lineColor === 'custom') {
                lineColor = document.getElementById('customLineColor').value;
            }
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 0.5;

            const drawLines = (size) => {
                let headerPixels = headerHeight * 3.78;
                const titleSectionHeight = titleSection ? 20 * 3.78 : 0; // 20mm for title section
                
                // Draw header line
                ctx.beginPath();
                ctx.moveTo(0, headerPixels);
                ctx.lineTo(canvas.width, headerPixels);
                ctx.stroke();

                // Draw title section
                if (titleSection) {
                    ctx.lineWidth = 1;
                    ctx.strokeStyle = '#E6F3FF'; // Pale blue
                    for (let y of [10 * 3.78, 20 * 3.78]) {
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(canvas.width, y);
                        ctx.stroke();
                    }
                    ctx.lineWidth = 0.5;
                    ctx.strokeStyle = lineColor;
                }

                // Draw No. and Date fields
                if (noField || dateField) {
                    ctx.font = '10px Arial';
                    ctx.fillStyle = lineColor;
                    let fieldY = titleSection ? 25 * 3.78 : 5 * 3.78; // Adjust Y position based on title section

                    if (noField) {
                        ctx.fillText('No:', canvas.width - 70 * 3.78, fieldY);
                        ctx.save();
                        ctx.setLineDash([2, 2]); // Create dotted line
                        ctx.beginPath();
                        ctx.moveTo(canvas.width - 60 * 3.78, fieldY + 2);
                        ctx.lineTo(canvas.width - 10 * 3.78, fieldY + 2);
                        ctx.stroke();
                        ctx.restore();
                        fieldY += 7 * 3.78;
                    }

                    if (dateField) {
                        ctx.fillText('Date:', canvas.width - 70 * 3.78, fieldY);
                        for (let i = 0; i < 3; i++) {
                            const x = canvas.width - (60 - i * 20) * 3.78;
                            ctx.fillText('.', x, fieldY);
                        }
                    }
                }

                // Draw horizontal lines
                for (let y = headerPixels + titleSectionHeight + size; y <= canvas.height; y += size) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                if (redLine) {
                    ctx.strokeStyle = 'red';
                    ctx.beginPath();
                    ctx.moveTo(redLinePadding * 3.78, headerPixels + titleSectionHeight);
                    ctx.lineTo(redLinePadding * 3.78, canvas.height);
                    ctx.stroke();
                }
            };

            const size = spacing * 3.78;

            switch (paperType) {
                case 'grid':
                    drawGrid(size);
                    break;
                case 'dot':
                    drawDots(size);
                    break;
                case 'line':
                    drawLines(size);
                    break;
            }
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const pageSize = document.getElementById('pageSize').value;
            const [width, height] = pageSizes[pageSize];
            const pdf = new jsPDF({
                orientation: width > height ? 'l' : 'p',
                unit: 'mm',
                format: pageSize
            });

            pdf.addImage(canvas.toDataURL('image/jpeg', 1.0), 'JPEG', 0, 0, width, height);
            pdf.save('writing_paper.pdf');
        }

        function updateSpacingOptions() {
            const paperType = document.getElementById('paperType').value;
            const spacingSelect = document.getElementById('spacing');
            const options = spacingSelect.options;

            while (options.length > 0) {
                options.remove(0);
            }

            if (paperType === 'line') {
                for (let i = 6; i <= 10; i++) {
                    options.add(new Option(`${i}mm`, i));
                }
            } else {
                for (let i = 3; i <= 6; i++) {
                    options.add(new Option(`${i}mm`, i));
                }
            }

            spacingSelect.value = paperType === 'line' ? '7' : '3';
        }

        function updateRedLinePadding() {
            const pageSize = document.getElementById('pageSize').value;
            document.getElementById('redLinePadding').value = defaultRedLinePadding[pageSize];
        }

        function updateHeaderHeightVisibility() {
            const paperType = document.getElementById('paperType').value;
            const headerHeightContainer = document.getElementById('headerHeight').parentNode;
            headerHeightContainer.style.display = paperType === 'line' ? 'block' : 'none';

            const redLineCheckbox = document.getElementById('redLine').parentNode;
            redLineCheckbox.style.display = paperType === 'line' ? 'block' : 'none';

            const redLineContainer = document.getElementById('redLinePadding').parentNode;
            redLineContainer.style.display = paperType === 'line' ? 'block' : 'none';

            const lineTypeOptions = document.querySelectorAll('.checkbox-group')[0];
            lineTypeOptions.style.display = paperType === 'line' ? 'flex' : 'none';

        }

        function updateColorPickerVisibility(selectId, pickerId) {
            const select = document.getElementById(selectId);
            const picker = document.getElementById(pickerId);
            picker.style.display = select.value === 'custom' ? 'inline-block' : 'none';
        }

        // Update paper on any change
        document.querySelectorAll('select, input').forEach(el => {
            el.addEventListener('change', drawPaper);
        });

        // Update spacing options and header height visibility when paper type changes
        document.getElementById('paperType').addEventListener('change', () => {
            updateSpacingOptions();
            updateHeaderHeightVisibility();
            drawPaper();
        });

        // Update red line padding when page size changes
        document.getElementById('pageSize').addEventListener('change', () => {
            updateRedLinePadding();
            drawPaper();
        });

        // Update color picker visibility
        document.getElementById('bgColor').addEventListener('change', () => updateColorPickerVisibility('bgColor', 'customBgColor'));
        document.getElementById('lineColor').addEventListener('change', () => updateColorPickerVisibility('lineColor', 'customLineColor'));

        // Initial setup
        updateSpacingOptions();
        updateRedLinePadding();
        updateHeaderHeightVisibility();
        updateColorPickerVisibility('bgColor', 'customBgColor');
        updateColorPickerVisibility('lineColor', 'customLineColor');
        drawPaper();
    </script>
</body>

</html>